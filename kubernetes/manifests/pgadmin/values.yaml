common:
  enabled: true
  clusterIssuer: letsencrypt-prod

  deployment:
    imagePullSecrets: dockerhub-token
    enabled: true
    port: 80
    replicaCount: 1
    image: dpage/pgadmin4
    nodeSelector:
      kubernetes.io/hostname: pi
    resources:
      requests:
        memory: "500Mi"
        cpu: "100m"
      # limits:
      #   memory: "500Mi"
      #   limits: "1000m"
    env:
      - name: PGADMIN_CONFIG_AUTHENTICATION_SOURCES
        value: "\"['oauth2', 'internal']\""
      - name: PGADMIN_DEFAULT_EMAIL
        valueFrom:
          secretKeyRef:
            name: pgadmin-password
            key: username
      - name: PGADMIN_DEFAULT_PASSWORD
        valueFrom:
          secretKeyRef:
            name: pgadmin-password
            key: password
      - name: PGADMIN_CONFIG_OAUTH2_NAME
        value: "'Authentik'"
      - name: PGADMIN_CONFIG_OAUTH2_DISPLAY_NAME
        value: "'Nullservers'"
      - name: PGADMIN_CONFIG_OAUTH2_CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: pgadmin-oidc-config
            key: client-id
      - name: PGADMIN_CONFIG_OAUTH2_CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: pgadmin-oidc-config
            key: client-secret
          
      - name: PGADMIN_CONFIG_OAUTH2_TOKEN_URL
        value: '"https://auth.nullservers.com/application/o/token"'
      - name: PGADMIN_CONFIG_OAUTH2_AUTHORIZATION_URL
        value: '"https://auth.nullservers.com/application/o/authorize"'
      - name: PGADMIN_CONFIG_OAUTH2_SERVER_METADATA_URL
        value: '"https://auth.nullservers.com/application/o/pgadmin/.well-known/openid-configuration"'
      - name: PGADMIN_CONFIG_OAUTH2_API_BASE_URL
        value: '"https://auth.nullservers.com"'
      - name: PGADMIN_CONFIG_OAUTH2_USERINFO_ENDPOINT
        value: '"https://auth.nullservers.com/application/o/userinfo"'
      - name: PGADMIN_CONFIG_OAUTH2_SCOPE
        value: '"openid email profile"'
      - name: PGADMIN_CONFIG_OIDC_REDIRECT_URI
        value: '"https://pgadmin.k8s.nullservers.com/oauth2/callback"'
      - name: PGADMIN_DISABLE_POSTFIX
        value: "True"


  pvcVolumeMounts:
    - mountPath: /var/lib/pgadmin
      name: config
      storageClassName: ssd-storage
      size: 2Gi

  service:
    enabled: true
    ports:
      - port: 80
        targetPort: 80
        name: http
        type: ClusterIP
  ingress:
    enabled: true
    class: cilium
    hosts:
      - host: pgadmin.k8s.nullservers.com
