---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMStaticScrape
metadata:
  name: postgres-exporters
  namespace: victoria-metrics
spec:
  jobName: postgres-exporter
  targetEndpoints:
    # PostgreSQL Exporter for immich database
    - targets:
        - "immich.pgsql.nullservers.com:9187"
      labels:
        instance: "immich-pgsql"
        service: "postgresql"
        database: "immich"
    # PostgreSQL Exporter for main database
    - targets:
        - "pgsql.nullservers.com:9187"
      labels:
        instance: "main-pgsql"
        service: "postgresql"
        database: "main"
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMStaticScrape
metadata:
  name: node-exporters-pgsql
  namespace: victoria-metrics
spec:
  jobName: node-exporter-pgsql
  targetEndpoints:
    # Node Exporter for immich PostgreSQL server
    - targets:
        - "immich.pgsql.nullservers.com:9100"
      labels:
        instance: "immich-pgsql"
        service: "node"
        role: "database-server"
    # Node Exporter for main PostgreSQL server
    - targets:
        - "pgsql.nullservers.com:9100"
      labels:
        instance: "main-pgsql"
        service: "node"
        role: "database-server"
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMStaticScrape
metadata:
  name: cadvisor-pgsql
  namespace: victoria-metrics
spec:
  jobName: cadvisor-pgsql
  targetEndpoints:
    # cAdvisor for immich PostgreSQL server
    - targets:
        - "immich.pgsql.nullservers.com:8080"
      labels:
        instance: "immich-pgsql"
        service: "cadvisor"
        role: "database-server"
    # cAdvisor for main PostgreSQL server
    - targets:
        - "pgsql.nullservers.com:8080"
      labels:
        instance: "main-pgsql"
        service: "cadvisor"
        role: "database-server"
