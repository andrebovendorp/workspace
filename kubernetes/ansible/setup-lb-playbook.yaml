- name: Setup host for kubernetes
  hosts: haproxy
  become: yes  # Ensures commands are run as a superuser
  vars:
    haproxy_config_path: /etc/haproxy/haproxy.cfg
  tasks:
  - name: Setup Hostname
    hostname:
      name: "{{ inventory_hostname }}"
      
  - name: Install HAProxy
    apt:
      name: haproxy
      state: present
      update_cache: yes

  - name: Generate HAProxy configuration
    template:
      src: haproxy.cfg.j2
      dest: "{{ haproxy_config_path }}"
      owner: root
      group: root
      mode: '0644'

  - name: Restart HAProxy to apply changes
    systemd:
      name: haproxy
      state: restarted
      enabled: true